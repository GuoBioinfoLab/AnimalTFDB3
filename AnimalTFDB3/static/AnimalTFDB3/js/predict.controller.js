
"use strict";

angular.module('AnimalTFDB3')
    .controller('PredictController', PredictController)
    .controller('TfbsPredictController',TfbsPredictController);

function PredictController($scope,$http,$routeParams,AnimalTFDBservice,$window) {
    $scope.result=0;
    $scope.predict_start=0;
    console.log("PredictController loaded");
    var result_dir="";
    $scope.load=function () {
        $scope.input_seq=">Q7Z591\n"+"MASSETEIRWAEPGLGKGPQRRRWAWAEDKRDVDRSSSQSWEEERLFPNATSPELLEDFR\n" +
            "LAQQHLPPLEWDPHPQPDGHQDSESGETSGEEAEAEDVDSPASSHEPLAWLPQQGRQLDM\n" +
            "TEEEPDGTLGSLEVEEAGESSSRLGYEAGLSLEGHGNTSPMALGHGQARGWVASGEQASG\n" +
            "DKLSEHSEVNPSVELSPARSWSSGTVSLDHPSDSLDSTWEGETDGPQPTALAETLPEGPS\n" +
            "HHLLSPDGRTGGSVARATPMEFQDSSAPPAQSPQHATDRWRRETTRFFCPQPKEHIWKQT\n" +
            "KTSPKPLPSRFIGSISPLNPQPRPTRQGRPLPRQGATLAGRSSSNAPKYGRGQLNYPLPD\n" +
            "FSKVGPRVRFPKDESYRPPKSRSHNRKPQAPARPLIFKSPAEIVQEVLLSSGEAALAKDT\n" +
            "PPAHPITRVPQEFQTPEQATELVHQLQEDYHRLLTKYAEAENTIDQLRLGAKVNLFSDPP\n" +
            "QPNHSIHTGMVPQGTKVLSFTIPQPRSAEWWPGPAEDPQASAASGWPSARGDLSPSSLTS\n" +
            "MPTLGWLPENRDISEDQSSAEQTQALASQASQFLAKVESFERLIQAGRLMPQDQVKGFQR\n" +
            "LKAAHAALEEEYLKACREQHPAQPLAGSKGTPGRFDPRRELEAEIYRLGSCLEELKEHID\n" +
            "QTQQEPEPPGSDSALDSTPALPCLHQPTHLPAPSGQAPMPAIKTSCPEPATTTAAASTGP\n" +
            "CPLHVNVEVSSGNSEVEDRPQDPLARLRHKELQMEQVYHGLMERYLSVKSLPEAMRMEEE\n" +
            "EEGEEEEEEEGGGDSLEVDGVAATPGKAEATRVLPRQCPVQAEKSHGAPLEEATEKMVSM\n" +
            "KPPGFQASLARDGHMSGLGKAEAAPPGPGVPPHPPGTKSAASHQSSMTSLEGSGISERLP\n" +
            "QKPLHRGGGPHLEETWMASPETDSGFVGSETSRVSPLTQTPEHRLSHISTAGTLAQPFAA\n" +
            "SVPRDGASYPKARGSLIPRRATEPSTPRSQAQRYLSSPSGPLRQRAPNFSLERTLAAEMA\n" +
            "VPGSEFEGHKRISEQPLPNKTISPPPAPAPAAAPLPCGPTETIPSFLLTRAGRDQAICEL\n" +
            "QEEVSRLRLRLEDSLHQPLQGSPTRPASAFDRPARTRGRPADSPATWGSHYGSKSTERLP\n" +
            "GEPRGEEQIVPPGRQRARSSSVPREVLRLSLSSESELPSLPLFSEKSKTTKDSPQAARDG\n" +
            "KRGVGSAGWPDRVTFRGQYTGHEYHVLSPKAVPKGNGTVSCPHCRPIRTQDAGGAVTGDP\n" +
            "LGPPPADTLQCPLCGQVGSPPEADGPGSATSGAEKATTRRKASSTPSPKQRSKQAGSSPR\n" +
            "PPPGLWYLATAPPAPAPPAFAYISSVPIMPYPPAAVYYAPAGPTSAQPAAKWPPTASPPP\n" +
            "ARRHRHSIQLDLGDLEELNKALSRAVQAAESVRSTTRQMRSSLSADLRQAHSLRGSCLF\n"+
            ">P18846\n"+"MEDSHKSTTSETAPQPGSAVQGAHISHIAQQVSSLSESEESQDSSDSIGSSQKAHGILAR\n" +
            "RPSYRKILKDLSSEDTRGRKGDGENSGVSAAVTSMSVPTPIYQTSSGQYIAIAPNGALQL\n" +
            "ASPGTDGVQGLQTLTMTNSGSTQQGTTILQYAQTSDGQQILVPSNQVVVQTASGDMQTYQ\n" +
            "IRTTPSATSLPQTVVMTSPVTLTSQTTKTDDPQLKREIRLMKNREAARECRRKKKEYVKC\n" +
            "LENRVAVLENQNKTLIEELKTLKDLYSNKSV\n"+">P15336\n" +
            "MKFKLHVNSARQYKDLWNMSDDKPFLCTAPGCGQRFTNEDHLAVHKHKHEMTLKFGPARN\n" +
            "DSVIVADQTPTPTRFLKNCEEVGLFNELASPFENEFKKASEDDIKKMPLDLSPLATPIIR\n" +
            "SKIEEPSVVETTHQDSPLPHPESTTSDEKEVPLAQTAQPTSAIVRPASLQVPNVLLTSSD\n" +
            "SSVIIQQAVPSPTSSTVITQAPSSNRPIVPVPGPFPLLLHLPNGQTMPVAIPASITSSNV\n" +
            "HVPAAVPLVRPVTMVPSVPGIPGPSSPQPVQSEAKMRLKAALTQQHPPVTNGDTVKGHGS\n" +
            "GLVRTQSEESRPQSLQQPATSTTETPASPAHTTPQTQSTSGRRRRAANEDPDEKRRKFLE\n" +
            "RNRAAASRCRQKRKVWVQSLEKKAEDLSSLNGQLQSEVTLLRNEVAQLKQLLLAHKDCPV\n" +
            "TAMQKKSGYHTADKDDSSEDISVPSSPHTEAIQHSSVSTSNGVSSTSKAEAVATSVLTQM\n" +
            "ADQSTEPALSQIVMAPSSQSQPSGS\n"+">Q8WY36\n" +
            "MKGSNRNKDHSAEGEGVGKRPKRKCLQWHPLLAKKLLDFSEEEEEEDEEEDIDKVQLLGA\n" +
            "DGLEQDVGETEDDESPEQRARRPMNAFLLFCKRHRSLVRQEHPRLDNRGATKILADWWAV\n" +
            "LDPKEKQKYTDMAKEYKDAFMKANPGYKWCPTTNKPVKSPTPTVNPRKKLWAFPSDSSRD\n" +
            "LPSPKKAKTEEMPQLNFGMADPTQMGGLSMLLLAGEHALGTPEVSSGTCRPDVSESPELR\n" +
            "QKSPLFQFAEISSSTSHSDASTKQCQTSALFQFAEISSNTSQLGGAEPVKRCGKSALFQL\n" +
            "AEMCLASEGMKMEESKLIKAKESDGGRIKELEKGKEEKEIKMEKTDETRLQKEAEFEKSA\n" +
            "KENLRDSKELRNFEALQIDDIMAIKMEDPKEIRKEELEEDHKCSHFPDFSYSASSKIIIS\n" +
            "DVPSRKDHMCHPHGIMIIEDPAALNKPEKLKKKKKKSKMDRHGNDKSTPKKTCKKRQSSE\n" +
            "SDIESVIYTIEAVAKGDWGIEKLGDTPRKKVRTSSSGKGSILDAKPPKKKVKSREKKMSK\n" +
            "EKSSDTTKESRPPDFISISASKNISGETPEGIKAEPLTPMEDALPPSLSGQAKPEDSDCH\n" +
            "RKIETCGSRKSERSCKGALYKTLVSEGMLTSLRANVDRGKRSSGKGNSSDHEGCWNEESW\n" +
            "TFSQSGTSGSKKFKKTKPKEDCLLGSAKLDEEFEKKFNSLPQYSPVTFDRKCVPVPRKKK\n" +
            "KTGNVSSEPTKTSKGPFQSQKKNLFHKIVSKYKHKKEKPNVPEKGSGDKWSNKQLFLDAI\n" +
            "HPTEAIFSEDRNTMEPVHKVKNIPSIFNTPEPTTTQEPLVGSQKRKARKTKITHLVRTAD\n" +
            "GRVSPAGGTLDDKPKEQLQRSLPKATETDCNDKCSHNTEVGETRSSTPEMPAVSAFFSLA\n" +
            "ALAEVAAMENVHRGQRSTPLTHDGQPKEMPQAPVLISCADQ\n"+">P15976\n" +
            "MEFPGLGSLGTSEPLPQFVDPALVSSTPESGVFFPSGPEGLDAAASSTAPSTATAAAAAL\n" +
            "AYYRDAEAYRHSPVFQVYPLLNCMEGIPGGSPYAGWAYGKTGLYPASTVCPTREDSPPQA\n" +
            "VEDLDGKGSTSFLETLKTERLSPDLLTLGPALPSSLPVPNSAYGGPDFSSTFFSPTGSPL\n" +
            "NSAAYSSPKLRGTLPLPPCEARECVNCGATATPLWRRDRTGHYLCNACGLYHKMNGQNRP\n" +
            "LIRPKKRLIVSKRAGTQCTNCQTTTTTLWRRNASGDPVCNACGLYYKLHQVNRPLTMRKD\n" +
            "GIQTRNRKASGKGKKKRGSSLGGTGAAEGPAGGFMVVAGGSGSGNCGEVASGLTLGPPGT\n" +
            "AHLYQGLGPVVLSGPVSHLMPFPGPLLGSPTGSFPTGPMPPTTSTTVVAPLSS\n"+">P23769\n" +
            "MEVAPEQPRWMAHPAVLNAQHPDSHHPGLAHNYMEPAQLLPPDEVDVFFNHLDSQGNPYY\n" +
            "ANPAHARARVSYSPAHARLTGGQMCRPHLLHSPGLPWLDGGKAALSAAAAHHHNPWTVSP\n" +
            "FSKTPLHPSAAGGPGGPLSVYPGAGGGSGGGSGSSVASLTPTAAHSGSHLFGFPPTPPKE\n" +
            "VSPDPSTTGAASPASSSAGGSAARGEDKDGVKYQVSLTESMKMESGSPLRPGLATMGTQP\n" +
            "ATHHPIPTYPSYVPAAAHDYSSGLFHPGGFLGGPASSFTPKQRSKARSCSEGRECVNCGA\n" +
            "TATPLWRRDGTGHYLCNACGLYHKMNGQNRPLIKPKRRLSAARRAGTCCANCQTTTTTLW\n" +
            "RRNANGDPVCNACGLYYKLHNVNRPLTMKKEGIQTRNRKMSNKSKKSKKGAECFEELSKC\n" +
            "MQEKSSPFSAAALAGHMAPVGHLPPFSHSGHILPTPTPIHPSSSLSFGHPHPSSMVTAMG\n"+
            ">Q4AE62\nMSILIIEAFYGGSHKQLVDLLQEELGDCVVYTLPAKKWHWRARTSALYFSQTIPISEHYR\n" +
            "TLFASSVLNLTELAALRPDLGKLKKILYFHENQLIYPVKKCQERDFQYGYNQILSCLVAD\n" +
            "VVVFNSVFNMESFLTSMGKFMKLIPDHRPKDLESIIRPKCQVIYFPIRFPDVSRFMPKHK\n" +
            "TTHLKKMLGLKGNGGAVLSMALPFQPEQRDSEDLLKNFNSECDTHCGLDTARQEYLGNSL\n" +
            "RQESDLKKSTSSDNSSSHHGENKQNLTVDPCDILGGVDNQQRLLHIVWPHRWEHDKDPES\n" +
            "FFKVLMHLKDLGLNFHVSVLGETFTDVPDIFSEAKKALGSSVLHWGYLPSKDDYFQVLCM\n" +
            "ADVVISTAKHEFFGVAMLEAVYCGCYPLCPKDLVYPEIFPAEYLYSTPEQLSKRLQNFCK\n" +
            "RPDIIRKHLYKGEIAPFSWAALHGKFRSLLTTEPREDL\n"+">P78347\nMAQVAMSTLPVEDEESSESRMVVTFLMSALESMCKELAKSKAEVACIAVYETDVFVVGTE\n" +
            "RGRAFVNTRKDFQKDFVKYCVEEEEKAAEMHKMKSTTQANRMSVDAVEIETLRKTVEDYF\n" +
            "CFCYGKALGKSTVVPVPYEKMLRDQSAVVVQGLPEGVAFKHPENYDLATLKWILENKAGI\n" +
            "SFIIKRPFLEPKKHVGGRVMVTDADRSILSPGGSCGPIKVKTEPTEDSGISLEMAAVTVK\n" +
            "EESEDPDYYQYNIQAGPSETDDVDEKQPLSKPLQGSHHSSEGNEGTEMEVPAEDSTQHVP\n" +
            "SETSEDPEVEVTIEDDDYSPPSKRPKANELPQPPVPEPANAGKRKVREFNFEKWNARITD\n" +
            "LRKQVEELFERKYAQAIKAKGPVTIPYPLFQSHVEDLYVEGLPEGIPFRRPSTYGIPRLE\n" +
            "RILLAKERIRFVIKKHELLNSTREDLQLDKPASGVKEEWYARITKLRKMVDQLFCKKFAE\n" +
            "ALGSTEAKAVPYQKFEAHPNDLYVEGLPENIPFRSPSWYGIPRLEKIIQVGNRIKFVIKR\n" +
            "PELLTHSTTEVTQPRTNTPVKEDWNVRITKLRKQVEEIFNLKFAQALGLTEAVKVPYPVF\n" +
            "ESNPEFLYVEGLPEGIPFRSPTWFGIPRLERIVRGSNKIKFVVKKPELVISYLPPGMASK\n" +
            "INTKALQSPKRPRSPGSNSKVPEIEVTVEGPNNNNPQTSAVRTPTQTNGSNVPFKPRGRE\n" +
            "FSFEAWNAKITDLKQKVENLFNEKCGEALGLKQAVKVPFALFESFPEDFYVEGLPEGVPF\n" +
            "RRPSTFGIPRLEKILRNKAKIKFIIKKPEMFETAIKESTSSKSPPRKINSSPNVNTTASG\n" +
            "VEDLNIIQVTIPDDDNERLSKVEKARQLREQVNDLFSRKFGEAIGMGFPVKVPYRKITIN\n" +
            "PGCVVVDGMPPGVSFKAPSYLEISSMRRILDSAEFIKFTVIRPFPGLVINNQLVDQSESE\n" +
            "GPVIQESAEPSQLEVPATEEIKETDGSSQIKQEPDPTW\n"+">Q9BX10\nMDSRVSELFGGCCRPGGGPAVGGTLKARGAGSSSGCGGPKGKKKNGRNRGGKANNPPYLP\n" +
            "PEAEDGNIEYKLKLVNPSQYRFEHLVTQMKWRLQEGRGEAVYQIGVEDNGLLVGLAEEEM\n" +
            "RASLKTLHRMAEKVGADITVLREREVDYDSDMPRKITEVLVRKVPDNQQFLDLRVAVLGN\n" +
            "VDSGKSTLLGVLTQGELDNGRGRARLNLFRHLHEIQSGRTSSISFEILGFNSKGEVVNYS\n" +
            "DSRTAEEICESSSKMITFIDLAGHHKYLHTTIFGLTSYCPDCALLLVSANTGIAGTTREH\n" +
            "LGLALALKVPFFIVVSKIDLCAKTTVERTVRQLERVLKQPGCHKVPMLVTSEDDAVTAAQ\n" +
            "QFAQSPNVTPIFTLSSVSGESLDLLKVFLNILPPLTNSKEQEELMQQLTEFQVDEIYTVP\n" +
            "EVGTVVGGTLSSGICREGDQLVVGPTDDGCFLELRVCSIQRNRSACRVLRAGQAATLALG\n" +
            "DFDRALLRKGMVMVSPEMNPTICSVFEAEIVLLFHATTFRRGFQVTVHVGNVRQTAVVEK\n" +
            "IHAKDKLRTGEKAVVRFRFLKHPEYLKVGAKLLFREGVTKGIGHVTDVQAITAGEAQANMGF\n"+
            ">Q969Y2\nMWRGLWTLAAQAARGPRRLCTRRSSGAPAPGSGATIFALSSGQGRCGIAVIRTSGPASGH\n" +
            "ALRILTAPRDLPLARHASLRLLSDPRSGEPLDRALVLWFPGPQSFTGEDCVEFHVHGGPA\n" +
            "VVSGVLQALGSVPGLRPAEAGEFTRRAFANGKLNLTEVEGLADLIHAETEAQRRQALRQL\n" +
            "DGELGHLCRGWAETLTKALAHVEAYIDFGEDDNLEEGVLEQADIEVRALQVALGAHLRDA\n" +
            "RRGQRLRSGVHVVVTGPPNAGKSSLVNLLSRKPVSIVSPEPGTTRDVLETPVDLAGFPVL\n" +
            "LSDTAGLREGVGPVEQEGVRRARERLEQADLILAMLDASDLASPSSCNFLATVVASVGAQ\n" +
            "SPSDSSQRLLLVLNKSDLLSPEGPGPGPDLPPHLLLSCLTGEGLDGLLEALRKELAAVCG\n" +
            "DPSTDPPLLTRARHQHHLQGCLDALGHYKQSKDLALAAEALRVARGHLTRLTGGGGTEEI\n" +
            "LDIIFQDFCVGK\n";
    };
    $scope.get_result=function () {
        var base_url = AnimalTFDBservice.getAPIBaseUrl();
        $scope.predict_start=1;
        var seq=$scope.input_seq;
        $http({
            url: base_url + '/api/prediction',
            method: 'POST',
            data:{input_seq:seq}
        }).then(
            function (response) {
                $scope.result=1;
                console.log(response.data);
                $scope.predict_start=0;
                $scope.result_ls= response.data.result;
                $scope.dir=response.data.dir;
                result_dir=response.data.dir;
                $scope.seq_count=response.data.seq_count;
                $scope.hit_count=response.data.hit_count
            }
        )
    };
    $scope.show_detail=function (protein) {
        var tf=protein["TF"];
        // console.log("211.67.31.242/static/AnimalTFDB3/predict_result_tmp_file/"+result_dir+"/"+tf+"_alignment.detail","_blank");
        window.open("/static/AnimalTFDB3/predict_result_tmp_file/"+result_dir+"/"+tf+"_alignment.detail","_blank");
    };
    $scope.reset=function () {
        $scope.input_seq="";
    }
}
function TfbsPredictController($scope,$http,$routeParams,AnimalTFDBservice,$window) {
    var base_url = AnimalTFDBservice.getAPIBaseUrl();
     $("[data-toggle='popover']").popover();
    var result_list=[];
    $scope.load=function () {
        $scope.fasta=">Example\nATCGATCGACTAGCTAGCTAGCTACGATCGATCGATCAGCTGACTGACTAGCTACGTCG";
    };
    $scope.reset=function () {
        $scope.input_seq="";
    };
    $scope.predict = function () {
        if (!$scope.fasta || !$scope.fasta.trim()) {
            alert("Please input a fasta sequence!");
            return;
        }
        $scope.loading = true;
        $scope.result=0;
        $scope.tfs=[];
        $scope.prediction_results = null; 
        $http({
            url: base_url + '/api/tfbs_prediction',
            method: 'POST',
            data: {fasta:$scope.fasta}
        }).then(
            function (response) {
                $scope.loading = false;
                console.log(response.data.result);
                result_list=response.data.result;
                $scope.result_ls=result_list;
                var check_list=[];
                var tf_list=[];
                if (result_list.length>0){
                    $scope.result=1
                }else{
                    $scope.zero=1
                }
                tf_list.push({"tf":"All"});
                for (var i=0;i<result_list.length;i++){
                    var spe=result_list[i];
                    var va=spe["tf"];
                    if (check_list.indexOf(va)<0){
                        check_list.push(va);
                        tf_list.push({"tf":va})
                    }
                }
                $scope.tf_list=tf_list;
            },
            function () {
                $scope.loading = false;
            }
        )
    };
    $scope.filter_tf=function () {
        var tf = $("#filter_tf").val();
        var new_arr=[];
        if (tf=="All"){
            $scope.result_ls=result_list
        }else{
            for(var i=0;i<result_list.length;i++){
                var temp=result_list[i];
                if (temp["tf"]==tf){
                    new_arr.push(temp)
                }
            }
            $scope.result_ls=new_arr
        }

    };
}
